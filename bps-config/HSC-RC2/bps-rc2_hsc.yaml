pipelineYaml: HSC-PANDA.yaml
#qgraphFile: /home/madamow/gen2-to-gen3/bps/submit/RC2/w_2021_02/DM-28282/20210217T154224Z/RC2_w_2021_02_DM-28282_20210217T154224Z.qgraph 
project: dev
campaign: "G3W06"
computeSite: ncsapool

payload:
  runInit: true
  payloadName: rc2
  butlerConfig: /project/hsc/gen3repo/rc2w06_ssw06/butler.yaml
  inCollection: HSC/calib,HSC/raw/all,HSC/masks,refcats,skymaps
  output: "RC2/w_2021_06/DM-28654"
  outCollection: "{output}/{timestamp}"
  # tracts (smallest to largest): 9615, 9697, 9813
  dataQuery: "tract = 9615 and patch=30 and instrument='HSC' and skymap='hsc_rings_v1'"

pipetask:
  pipetaskInit:
    runQuantumCommand: "${CTRL_MPEXEC_DIR}/bin/pipetask --long-log run -b {butlerConfig} -i {inCollection} --output {output} --output-run {outCollection} --init-only --register-dataset-types --qgraph {qgraphFile} --clobber-partial-outputs --no-versions"
    requestMemory: 2048
  assembleCoadd:
    requestMemory: 8192
  deblend:
    requestMemory: 3000
  measure:
    requestMemory: 14000
  makeWarp:
    requestMemory: 85000

submitPath: ${PWD}/submit/{outCollection}
saveDot: False
requestMemory: 2048
requestCpus: 1
wmsServiceClass: lsst.ctrl.bps.wms.htcondor.htcondor_service.HTCondorService
clusterAlgorithm: lsst.ctrl.bps.quantum_clustering_funcs.single_quantum_clustering
createQuantumGraph: '${CTRL_MPEXEC_DIR}/bin/pipetask qgraph -d "{dataQuery}" -b {butlerConfig} -i {inCollection} -p {pipelineYaml} -q {qgraphFile} --qgraph-dot {qgraphFile}.dot'
runQuantumCommand: "${CTRL_MPEXEC_DIR}/bin/pipetask --long-log run -b {butlerConfig} -i {inCollection} --output {output} --output-run {outCollection} --extend-run --skip-init-writes --qgraph {qgraphFile} --clobber-partial-outputs --no-versions"
templateDataId: "{tract}_{patch}_{band}_{visit}_{exposure}_{detector}"
